# 웹 페이지 연결 기능

웹 페이지들은 어떻게 정보를 공유할까?

포털 사이트를 이용하다보면 로그인 상태가 여러 웹 페이지에 걸쳐서 계속 유지되는 것을 볼 수 있다.

하지만 실제 HTTP 프로토콜 방식으로 통신하는 웹 페이지들은 서로 어떤 정보도 공유하지 않는다(stateless 방식).

그래서 사용자 입장에서 웹 페이지 사이의 상태나 정보를 공유하려면 프로그래머가 세션 트래킹이라는 웹 페이지 연결 기능을 구현해야 한다.



세션 트래킹 방법은 다음과 같다.

- <hidden> 태그

- URL Rewriting

GET 방식으로 URL 뒤에 정보를 붙여서 다른 페이지로 전송

- 쿠키

클라이언트 PC의 Cookie 파일에 정보를 저장한 후 웹 페이지들이 공유

- 세션

서버 메모리에 정보를 저장한 후 웹 페이지들이 공유



이 중에서 <hidden>태그와 URL Rewriting은 이미 이전에 살펴본 바 있다.

이번에는 쿠키와 세션에 대해 집중적으로 살펴보자.



## Cookie

쿠키의 특징은 다음과 같다.

- 정보가 클라이언트 PC에 저장된다.
- 저장 정보 용량에 제한이 있다.
- 보안이 취약하다.
- 클라이언트 브라우저에서 사용 유무를 설정할 수 있다.
- 도메인, 웹사이트당 하나의 쿠키가 만들어진다.



쿠키의 종류는 다음과 같다.

| 속성                   | Persistence 쿠키                             | Session 쿠키                                 |
| ---------------------- | -------------------------------------------- | -------------------------------------------- |
| 생성 위치              | 파일로 생성                                  | 브라우저 메모리에 생성                       |
| 종료 시기              | 쿠키를 삭제하거나 쿠키 설정 값이 종료된 경우 | 브라우저를 종료한 경우                       |
| 최초 접속 시 전송 여부 | 최초 접속 시 서버로 전송                     | 최초 접속 시 서버로 전송되지 않음            |
| 용도                   | 로그인 유무 또는 팝업창을 제한할 때          | 사이트 접속 시 Session 인증 정보를 유지할 때 |



쿠키 기능 실행 과정은 다음과 같다.

1. 브라우저로 사이트에 접속
2. 서버는 정보를 저장한 쿠키를 생성 / addCookie() 메서드 사용
3. 생성된 쿠키를 브라우저로 전송 / getCookie() 메서드 사용
4. 브라우저는 서버로부터 받은 쿠키 정보를 쿠키 파일에 저장
5. 브라우저가 다시 접속해 서버가 브라우저에게 쿠키 전송을 요청하면 브라우저는 쿠키 정보를 서버에 넘겨준다.
6. 서버는 쿠키 정보를 이용해 작업



다음은 서블릿 안에서 쿠키를 만드는 과정이다. 

```java
Cookie c = new Cookie("cookieTest", URLEncoder.encode("쿠키 전송 성공!"), "utf-8");
c.setMaxAge(24*60*60); // Persistence 쿠키
c.setMaxAge(-1) // Session 쿠키
    
//------------------------------------------------------------------

Cookie[] allValues = request.getCookies();
for(int i=0; i<allValues.length; i++){
    if(allValues[i].getName().equals("cookieTest")){
        out.println(URLDecoder.decode(allValues[i].getValue(), "utf-8");
    }
}
```

유효 시간을 어떻게 설정하느냐에 따라 Persistence 쿠키 혹은 Session 쿠키를 만들 수 있다.



그 아래는 쿠키에 저장된 값을 가져오는 과정이다.

getCookies() 메서드로 브라우저에게 쿠키 정보를 요청한 후 쿠키 정보를 배열로 가져온다.

위에서 쿠키 정보를 저장할 때 사용한 쿠키 이름을 검색해 쿠키 값을 가져온다.



## Session

세션의 특징은 다음과 같다.

- 정보가 서버의 메모리에 저장된다.
- 브라우저의 세션 연동은 세션 쿠키를 이용한다.
- 쿠키보다 보안에 유리하다.
- 서버에 부하를 줄 수 있다.

세션은 서버의 자원을 사용하는 것이기 때문에 무분별하게 만들면 서버의 메모리가 감당하기 어려워 속도가 느려질 수 있다.

- 브라우저당 한 개의 세션이 생성된다.

- 세션은 유효 시간을 가진다.(기본 유효 시간은 30분)
- 로그인 상태 유지 기능이나 쇼핑몰의 장바구니 담기 기능 등의 주로 사용됨.



세션 실행 과정은 다음과 같다.

1. 브라우저로 사이트에 접속
2. 서버는 접속한 브라우저에 대한 세션 객체 생성
3. 서버는 생성된 세션 id를 클라이언트 브라우저에 전송
4. 브라우저는 서버로부터 받은 세션 id를 브라우저가 사용하는 메모리의 세션 쿠키에 저장
5. 브라우저가 재접속하면 브라우저는 세션 쿠키에 저장된 세션 id를 서버에 전달
6. 서버는 전송된 세션 id를 이용해 해당 세션에 접근하여 작업을 수행



```java
HttpSession session = request.getSession();
```

getSession() 메서드는 세션 객체를 새로 생성하거나 기존 세션을 반환한다.



# :books:참고자료

- https://interconnection.tistory.com/74
- 이병승, 자바 웹을 다루는 기술, 도서출판 길벗, 2019