# PART 2 SQL 기본

# 1. 관계형 데이터베이스

# 1-1. 관계형 데이터베이스

## 1) 관계형 데이터베이스의 등장

- 관계형 데이터베이스는 릴레이션과 릴레이션의 조인을 연산을 통해서 합집합, 교집합, 차집합 등을 만들 수 있다.

릴레이션 : 주로 테이블과 같은 의미로 사용되지만, 테이블이 릴레이션보다 큰 의미이다.

따라서 모든 릴레이션은 테이블이 될 수 있지만 모든 테이블은 릴레이션이 될 수 없다.



## 2) 데이터베이스와 데이터베이스 관리 시스템의 차이점

- 데이터베이스의 종류

  - 계층형 데이터베이스 : 1대N 관계를 표현한다.

  - 네트워크형 데이터베이스 : 1대N과 M대N 관계도 표현 가능하다.

  - 관계형 데이터베이스 : 릴레이션에 데이터를 저장하고 관리한다.

    | 종목코드 | 종목명   |
    | -------- | -------- |
    | S1000    | 삼성전자 |
    | S1002    | 국민은행 |
    | S1003    | 대신증권 |
  
  
  
  - 이러한 데이터베이스를 관리하는 것이 데이터 베이스 관리 시스템(DBMS)이다.



## 3) 관계형 데이터베이스 집합 연산과 관계 연산

- 집합 연산

| 집합 연산                 | 설명                                                         |
| ------------------------- | ------------------------------------------------------------ |
| 합집합(Union)             | 두 개의 릴레이션을 하나로 합하는 것이다.<br />중복된 행은 한 번만 조회한다. |
| 차집합(Difference)        | 본래 릴레이션에만 존재하고 다른 릴레이션에 존재하지 않는 것을 조회 |
| 교집합(Intersection)      | 두 개의 릴레이션들 중 공통된 것 조회                         |
| 곱집합(Cartesian product) | 각 릴레이션에 존재하는 모든 데이터를 조합 후 연산            |

- 관계 연산

| 관계 연산   | 설명                                                         |
| ----------- | ------------------------------------------------------------ |
| 선택 연산   | 릴레이션에서 조건에 맞는 행만을 조회                         |
| 투영 연산   | 릴레이션에서 조건에 맞는 속성만을 조회                       |
| 결합 연산   | 여러 릴레이션의 공통된 속성을 사용해서 새로운 릴레이션 생성  |
| 나누기 연산 | 기준 릴레이션에서 나누는 릴레이션이 가지고 있는 속성과 동일한 값을 가지는 행을 추출하고<br />나누는 릴레이션의 속성 삭제 후 중복된 행을 제거하는 연산 |

## 2. 테이블의 구조

- 기본키(Primary key) : 하나의 테이블에서 유일성과 최소성, Not Null을 만족하면서 해당 테이블을 대표하는 것
- 테이블은 행과 칼럼으로 구성되며, 그 중에서 행은 하나의 테이블에 저장되는 값으로 튜플이라고도 함
- 칼럼은 어떤 데이터를 저장하기 위한 필드로 속성이라고도 함
- 외래키는 다른 테이블의 기본키를 참조하는 칼럼

# 2. SQL 종류

# 2-1. SQL

- SQL은 ANSI/ISO 표준을 준수하기 떄문에 데이터베이스 관리 시스템이 변경되어도 사용 가능



# 2-2. SQL 종류

## (1) SQL의 종류

| 종류                              | 설명                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| DDL(Data Definition Language)     | 관계형 데이터베이스 구조 정의<br />create, alter, drop, rename 등 |
| DML(Data Manipulation Language)   | 테이블에 데이터 입력, 수정, 삭제, 조회<br />insert, update, delete, select 등 |
| DCL(Data Control Language)        | 데이터베이스 사용자에게 권한 부여하거나 회수<br />grant, revoke, truncate |
| TCL(Transaction Control Language) | 트랜잭션 제어<br />commit, rollback, savepoint               |

## (2) 트랜잭션

- 트랜잭션은 데이터베이스의 작업을 처리하는 단위

| 트랜잭션 특성 | 설명                                                         |
| ------------- | ------------------------------------------------------------ |
| 원자성        | 트랜잭션의 처리가 완전히 끝나지 않았을 경우는 실행되지 않은 상태와 같아야 한다. |
| 일관성        | 트랜잭션 실행 결과로 데이터베이스의 상태가 모순되지 않아야 한다. |
| 고립성        | 트랜잭션 실행 중에 생성하는 연산의 중간결과는 다른 트랜잭션 접근 불가 |
| 영속성        | 트랜잭션이 그 실행을 성공적으로 완료하면 그 결과는 영구적 보장이 되어야 한다. |

## (3) SQL문의 실행 순서

1. 파싱(Parsing) : SQL문의 문법을 확인하고 구문분석
2. 실행(Execution) : 옵티마이저가 수립한 실행 계획에 따라 SQL 실행
3. 인출(Fetch) : 데이터 읽어서 전송



# 3. DDL

# 3-1. 테이블 생성

## (1) CASCADE 옵션

- CASCADE 옵션은 참조 관계가 있을 경우 참조되는 데이터를 자동으로 반영할 수 있는 것

```sql
constraint fk foreign key (deptno)
		references dept(deptno)
		on delete cascade
-- 현재 emp라는 직원 정보 테이블에서 부서 정보가 있는 dept 테이블을 참조중
```

- 테이블 생성시 외래키를 추가할 때 아래에 **ON DELETE CASCADE** 구문을 추가
- 자신이 참조하고 있는 테이블의 데이터가 삭제되면 자동으로 자신도 삭제되는 옵션
- 이로 인해 참조 무결성 준수 가능

## (2) 테이블 변경

```sql
alter table emp
	rename to new_emp;
	rename column ename to new_ename;
-- 테이블명 변경
-- 칼럼명 변경

alter table emp
	add (age number(2));
-- 테이블에 칼럼 추가

alter table emp
	modify (ename varchar2(30) not null);
-- 칼럼 정보 변경, 이 때 칼럼에 데이터가 존재하면 오류가 발생

alter table emp
	drop column age;
-- 칼럼 삭제
```

## (3) 테이블 삭제

```sql
drop table dept;
ORA-02449: unique/primary keys in table referenced by foreign keys
-- 오류 발생

drop table dept cascade constraints;

-- emp테이블이 dept테이블을 참조하고 있는 상황
-- 부모 테이블이 dept, 자식 테이블이 emp
-- dept 테이블을 삭제하기 위해서는 cascade constraints 옵션 추가
```

## (4) 뷰 생성과 삭제

- 뷰는 테이블로부터 유도된 가상의 테이블
- 실제 데이터를 가지고 있지 않고 테이블을 참조해서 원하는 칼럼만을 조회
- 뷰의 특징
  - 참조된 테이블이 변경되면 뷰도 변경
  - 뷰 입력, 수정, 삭제에는 제약이 있음
  - 특정 칼럼만 조회시키기 때문에 보안성 향상
  - 한 번 생성된 뷰는 수정 불가, 삭제 후 재생성해야 함
  - alter문으로 변경 불가

```sql
create view v_emp as
select * from emp;

select * from v_emp;
-- 일반 테이블처럼 조회
```



# 4. DML

# 4-1. Insert문

