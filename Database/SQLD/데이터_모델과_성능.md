# 데이터 모델과 성능

# 1. 정규화

# 1-1. 정규화

- 정규화는 데이터의 일관성, 최소한의 데이터 중복, 최대한의 데이터 유연성을 위한 방법이며 데이터를 분해하는 과정이다.
- 정규화를 수행하면 비즈니스에 변화가 발생해도 데이터 모델의 변경을 최소화할 수 있다.
- 정규화는 제1정규화부터 제5정규화까지 있지만, 실질적으로는 제3정규화까지만 수행한다.

- 정규화를 하지 않으면 여러 가지 문제들이 발생하는데, 이를 이상현상(Anomaly)라고 한다.
- 정규화된 모델은 테이블이 분해되는데, 분해된 테이블끼리 조인을 수행하여 하나의 합집합으로 만들 수도 있다.

| 정규화 절차 | 설명                                                         |
| ----------- | ------------------------------------------------------------ |
| 제1정규화   | 속성의 원자성을 확보한다.<br />기본키를 설정한다.            |
| 제2정규화   | 기본키가 2개 이상의 속성으로 이루어진 경우, 부분 함수 종속성을 제거한다. |
| 제3정규화   | 기본키를 제외한 칼럼 간에 종속성(이행 함수 종속성)을 제거한다. |
| BCNF        | 기본키를 제외하고 후보키가 있는 경우, 후보키가 기본키를 종속시키면 분해한다. |
| 제4정규화   | 여러 칼럼들이 하나의 칼럼을 종속시키는 경우 분해하여 다중값 종속성을 제거한다. |
| 제5정규화   | 조인에 의해서 종속성이 발생하는 경우 분해한다.               |

- 기본키가 하나의 칼럼으로 이루어져 있다면 제2정규화는 생략한다.



# 2. 정규화와 성능

# 2-1. 정규화의 문제점

- 정규화는 테이블을 분해해서 데이터 중복을 제거하기 때문에 데이터 모델의 유연성을 높인다.
- 하지만 정규화는 데이터 조회 시 조인을 유발하기 때문에 CPU와 메모리를 많이 사용한다.
- 이러한 성능 저하를 해결하기 위해 다시 테이블들을 합치는 반정규화를 수행하여 조인을 유발하지 않도록 한다.



# 2-2. 정규화를 사용한 성능 튜닝

- 반정규화를 통해 너무 많은 칼럼들이 하나의 테이블에 추가된다면, 데이터베이스 관리 시스템의 입출력 단위인 블록을 넘어서게 된다.
- 그렇게 되면 한 개의 행을 읽기 위해서 여러 블록을 읽어야 하고, 이는 성능 저하를 일으킨다.
- 이러한 문제가 발생한다면 다시 정규화를 통해 여러 테이블로 분해하고 성능을 향상시켜야 한다.



# 3. 반정규화

# 3-1. 반정규화

- 데이터베이스의 성능 상향을 위해 데이터 중복을 허용하고 조인을 줄이는 데이터베이스 성능 향상 방법이다.
- 반정규화는 조회 속도를 향상하지만, 데이터 모델의 유연성은 낮아진다.



# 3-2. 반정규화를 수행하는 경우

- 다량의 범위를 자주 처리해야 하는 경우
- 특정 범위의 데이터만 자주 처리하는 경우
- 요약/집계 정보가 자주 요구되는 경우

| 반정규화 절차     | 설명                                                         |
| ----------------- | ------------------------------------------------------------ |
| 대상 조사 및 검토 | 데이터 처리 범위, 통계성 등을 확인해서 반정규화 대상을 조사한다. |
| 다른 방법 검토    | 반정규화를 수행하기 전에 다른 방법이 있는지 검토한다.<br />예를 들어 클러스터링, 뷰, 인덱스 튜닝, 응용 프로그램, 파티션 등을 검토한다. |
| 반정규화 수행     | 테이블, 속성, 관계 등을 반정규화한다.                        |

클러스터링이란 인덱스 정보를 저장할 때 물리적으로 정렬해서 저장하는 방법이다.

따라서 데이터 조회 시에 인접 블록을 연속적으로 읽기 때문에 성능이 향상된다.



# 3-3. 반정규화 기법

## (1) 계산된 칼럼 추가

- 배치 프로그램으로 총판매액, 평균잔고, 계좌평가 등을 미리 계산하고, 그 결과를 특정 칼럼에 추가한다.

## (2) 테이블 수직분할

- 특정 칼럼 단위로 테이블을 분할하여 디스크I/O를 줄일 수 있는 방법이다.

## (3) 테이블 수평분할

- 하나의 테이블에 있는 값을 기준으로 테이블을 분할하는 방법이다.

## (4) 테이블 병합

- 1대1 관계의 테이블을 하나의 테이블로 병합해서 성능을 향상시킨다.
- 1대N 관계의 테이블을 병합하여 성능을 향상시킨다. 하지만 많은 양의 데이터 중복이 발생한다.
- 슈퍼 타입과 서브 타입 관계가 발생하면 테이블을 통합하여 성능을 향상시킨다.

고객 엔터티 --> 개인고객, 법인고객

이 때 고객 엔터티는 슈퍼 타입이고 개인고객과 법인고객은 서브 타입이다.

슈퍼 타입과 서브 타입의 관계는 배타적 관계와 포괄적 관계로 나뉜다.

배타적 관계는 고객이 개인 고객이거나 법인고객인 경우를 의미하며 포괄적 관계는 고객이 개인고객일 수도 있고 법인고객일 수도 있는 것이다.

| 변환 방법     | 설명                                                         |
| ------------- | ------------------------------------------------------------ |
| OneToOne Type | 개별 테이블 유지<br />테이블의 수가 많아서 조인이 많이 발생하고 관리가 어렵다. |
| Plus Type     | 슈퍼 타입+서브 타입 테이블로 도출한다.<br />조인이 발생하고 관리가 어렵다. |
| Single Type   | 슈퍼 타입과 서브 타입을 하나의 테이블로 도출한다.<br />조인 성능이 좋고 관리가 편리하지만, 입출력 성능이 나쁘다. |



# 4. 분산 데이터베이스

# 4-1. 분산 데이터베이스

- 한 대의 물리적 시스템에 데이터베이스 관리 시스템을 설치하고 여러 명의 사용자가 이용하는 것을 중앙 집중형 데이터베이스
- 물리적으로 떨어진 데이터베이스에 네트워크로 연결하여 단일 데이터베이스 이미지를 보여 주고 분산된 작업 처리를 수행하는 데이터베이스를 분산 데이터베이스라고 한다.
- 분산 데이터베이스를 사용하는 고객은 시스템이 네트워크로 분산되어 있는지의 여부를 인식하지 못하면서, 자신만의 데이터베이스를 사용하는 것처럼 사용할 수 있다. 이처럼 데이터베이스는 투명성을 제공해야 한다.
- 투명성은 분산 데이터베이스의 중요한 요소이며 투명성의 종류에는 분할, 위치, 지역사상, 중복, 장애 및 병행 투명성이 있다. 

| 투명성   | 설명                                                         |
| -------- | ------------------------------------------------------------ |
| 분할     | 고객은 하나의 논리적 릴레이션이 여러 단편으로 분할되어 각 단편의 사본이 여러 시스템에 저장되어 있음을 인식할 필요가 없다. |
| 위치     | 고객이 사용하려는 데이터의 저장 장소를 명시할 필요가 없다.<br />고객은 데이터가 어느 위치에 있더라도 동일한 명령을 사용하여 데이터에 접근할 수 있어야 한다. |
| 지역사상 | 지역 DBMS 와 물리적 DB 사이의 Mapping 보장. 각 지역 시스템 이름과 무관한 이름 사용가능 |
| 중복     | 데이터베이스 객체가 여러 시스템에 중복되어 존재함에도 고객과는 무관하게 데이터의 일관성이 유지된다. |
| 장애     | 데이터베이스가 분산되어 있는 각 지역의 시스템이나 통신망에 이상이 발생해도, 데이터의 무결성은 보장된다. |
| 병행     | 여러 고객의 응용 프로그램이 동시에 분산 데이터베이스에 대한 트랜잭션을 수행하는 경우에도 이상이 없다. |



# 4-2. 분산 데이터베이스 설계 방식

## (1) 상향식 설계 방식

- 지역 스키마 작성 후 향후 전역 스키마를 작성하여 분산 데이터베이스를 구축한다.
- 기업 전체의 전사 데이터 모델을 수렴하여 전역 스키마를 생성하고 그 다음 각 지역별로 지역 스키마를 생성하여 구축

## (2) 하향식 설계 방식

- 전역 스키마 작성 후 해당 지역 사상 스키마를 작성하여 분산 데이터베이스를 구축한다.
- 지역별로 데이터베이스를 구축한 후에 전역 스키마로 통합



기업에 여러 종류의 데이터베이스 관리 시스템이 있으면 이기종 데이터베이스 관리 시스템으로 연동해야 한다.

이기종 데이터베이스 시스템으로 연동하기 위해서는 데이터베이스 미들웨어(ODBC, JDBC)를 사용해야 한다.



| 장점                                                         | 단점                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 데이터베이스 신뢰성과 가용성이 높다.<br />분산 데이터베이스가 병렬 처리를 수행하기 때문에 빠른 응답이 가능하다.<br />분산 데이터베이스를 추가하여 시스템 용량 확장이 쉽다. | 데이터베이스가 여러 네트워크를 통해서 분리되어 있기 때문에 관리와 통제가 어렵다.<br />데이터 무결성 관리가 어렵다.<br />데이터베이스 설계가 복잡하다. |

