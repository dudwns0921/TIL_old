# 운영체제

## 병행 프로세스 1

### 병행 프로세스 개요

- 병행성
  
  - 여러 개의 프로세스 또는 쓰레드가 동시 수행되는 시스템의 특성
  
  - 프로세스가 실행되다가 완전히 종료되지 못한 중간 단계에 위치
  
  - 다른 프로세스도 동일한 단계일 경우

- 병행 프로세스
  
  - 동시 수행되는 여러 개의 프로세스 또는 쓰레드

#### 병행 프로세스의 실행 형태

- 1개의 CPU
  
  - 인터리빙 형식
  
  - CPU의 입장에서는 한 순간에는 하나의 프로세스밖에 실행을 하지 못함
  
  - RR처럼 번갈아가면서 프로세스를 실행하고 있는 것
  
  - CPU가 하나밖에 없더라도 병행 프로세스는 존재할 수 있음

- 여러 개의 CPU
  
  - 병렬처리 형식
  
  - 한 시점에 여러 프로세스를 처리할 수 있음

- 멀티프로세서 시스템에서의 메모리 구조에 따라
  
  - 강결합 시스템
    
    - 공유 메모리 구조
    
    - 여러 CPU가 하나의 메모리를 공유해서 사용하는 방식
    
    - 프로세스간의 통신을 할 때, 메모리 혹은 운영체제를 이용해서 수행 가능
  
  - 약결합 시스템
    
    - 분산 메모리 구조
    
    - 여러 개의 컴퓨터 시스템이 독립적으로 존재하며, 이들은 네트워크로 연결되어 있음
    
    - 프로세스간의 통신이 필요할 때는 무조건 네트워크를 통해서만 가능

#### 프로세스 간의 관계

- 독립 프로세스
  
  - 수행 중인 다른 프로세스에 영향을 주지도 받지도 않음
  
  - 데이터 및 상태를 다른 프로세스와 공유하지 않음
  
  - 프로세스의 실행
    
    - 결정적 : 실행결과는 입력에 의해서만 결정됨
    
    - 재생 가능 : 같은 입력에 대해 항상 동이한 실행 결과

- 협력 프로세스
  
  - 수행 중인 다른 프로세스와 영향을 주고 받음
  
  - 데이터 및 상태를 다른 프로세스와 공유
  
  - 프로세스의 실행
    
    - 비결정적
      
      - 실행결과는 실행순서에 좌우됨
    
    - 재생 불가능
      
      - 같은 입력에 대해 항상 동일한 실행결과를 보장하지 못함

### 병행성 문제

- 협력 프로세스인 경우 발생 가능한 문제
  
  - 상호배제
    
    - 2개 이상의 프로세스가 동시에 임계영역을 수행하지 못하도록 하는 것
      
      - 임계영역
        
        - 2개 이상의 프로세스가 동시에 사용하면 안 되는 공유자원을 액세스하는 프로그램 코드 영역
        
        - 두 프로세스가 존재하고 하나의 공유자원이 있다고 가정
        
        - 프로세스 A
          
          - 입금할 금액 확인
          
          - 잔고 확인
          
          - 잔고에다가 입금할 금액 더하기
          
          - 잔고의 값을 변경
        
        - 프로세스 B
          
          - 동일한 과정 수행
        
        - 프로세스 A의 작업 중간에 프로세스 B가 동일한 과정을 수행
        
        - 그렇게 되면 원하는 결과가 나오지 않음
        
        - 따라서 프로세스 A가 잔고 확인, 잔고에다가 입금할 금액을 더하고, 잔고의 값을 변경하는 동안에는 프로세스 B는 작업을 하면 안 됨. 이 부분을 임계 영역이라고 할 수 있음
        
        - 상호배제가 잘 되어야 작업이 정상적으로 일어날 수 있음
  
  - 동기화
    
    - 2개 이상의 프로세스에 대한 처리순서를 결정하는 것
      
      - 프로세스 동기화
      
      - 상호배제 : 임계영역에 대한 동기화 문제
      
      - 넓은 의미에서는 동기화 문제의 한 가지라고 볼 수 있음
  
  - 통신
    
    - 프로세스들이 데이터를 공유하기 위해 반드시 필요
      
      - 프로세스 간 통신
    
    - 통신 방법
      
      - 하나의 변수 사용 - 강결합 방식
      
      - 메시지를 서로 주고받음 - 약결합 방식

### 세마포어

- 상호배제와 동기화 문제를 해결하기 위한 도구

- Dijkstra가 제안

- 정수형 공용변수
  
  - 저장값 : 사용 가능한 자원의 수 또는 잠김이나 풀림의 상태

- 상황에 맞춰 0이상인 정수로 초기화

- 두 기본연산 p와 v에 의해서만 사용됨
  
  - 기본연산
    
    - 인터럽트되지 않고 하나의 단위로 처리됨
    
    - p 작업이 시작됐으면 중단되지 않는다는 의미
    
    - 이 특성이 있기 때문에 세마포어가 가능

- 연산 p
  
  - 검사, 감소시키려는 시도
  
  - 연산 p에 단순히 양수의 값이 들어왔다면 그냥 s 값을 감소시키고 종료
  
  - s가 양수가 아닐 경우, 연산 p를 호출한 프로세스를 대기시킴

- 연산 v
  
  - 증가
  
  - 대기하고 있는 프로세스가 있는지 확인 후 없을 경우, s의 값을 증가
  
  - 대기 중인 프로세스가 있으면 1개를 진행시킴
  
  - p 연산에 의해 대기가 된 프로세스들중 하나를 살려서 진행시킴

- 세마포어마다 대기 큐 필요

#### 상호배제 해결

- 상호배제를 위한 일반적인 요구사항
  
  - 한 프로세스가 임계영역 수행 중
    
    - 다른 프로세스는 임계영역에 진입해서는 안 됨
  
  - 임계영역 수행 중이던 프로세스가 임계영역 벗어남
    
    - 누군가 하나는 임계영역을 새로이 수행할 수 있어야 함
  
  - 임계영역 진입 못하고 대기하는 프로세스
    
    - 적절한 시간 내에 임계영역 수행을 시작할 수 있어야 함
    
    - 특정 프로세스보다 늦게 대기를 시작한 프로세스들이 임계영역을 진입하는 경우가 발생하지 않도록 해야 함

- 상호배제를 위한 임계영역 주변의 코드 영역
  
  - 진입영역
    
    - 임계영역에 대한 수행으르 해도 되는지 체크
  
  - 임계영역
  
  - 해제영역
    
    - 다른 프로세스가 임계영역 수행을 시작할 수 있도록 함

- 세마포어 이용
  
  - 상호배제
    
    - 세마포어 mutex 초깃값은 1
    
    - 진입영역 : P (mutex)
      
      - mutex가 1이기 때문에 1을 감소시키고 P 연산 끝남
      
      - 그리고 임계영역 진입
      
      - 다른 프로세스가 진입하려고 함
      
      - 하지만 세마포어의 값이 0이기 때문에 대기 상태로 들어감
      
      - 임계영역에는 오직 한 프로세스만 들어가게 됨
    
    - 해제영역 V (mutex)
      
      - 대기하는 프로세스가 있는지 판단
      
      - 대기하는 프로세스 하나를 깨워서 임계영역에 진입시킴
      
      - 대기하는 프로세스가 없을 경우 단순히 1을 증가시키기만 함
      
      - 그래서 다음에 다른 프로세스가 임계영역에 진입하려고 할 때 mutex가 1이기 때문에 바로 진입이 가능
    
    - 대기 큐는 FIFO로 동작
      
      - 진입 못하고 대기하는 프로세스가 없도록 함
  
  - 동기화 해결
    
    - 상황
      
      - 프로세스 A가 코드 s1을 수행한 후 프로세스B가 코드 S2를 수행하도록 동기화
      
      - 프로세스 A가 종료되는 순간에 연산 V를 수행
      
      - 프로세스 B가 시작되는 순간에 연산 P를 수행
      
      - 세마포어 sync 초깃값은 0
      
      - 프로세스 A가 종료되고 sync의 값이 1로 갱신
      
      - 그리고 프로세스 B가 시작될 때 sync의 값이 양수이기 때문에 B가 바로 실행됨
      
      - 누가 먼저 처리되든간에 V와 P 연산에 의해 원하는 순서대로 동기화가 이루어짐
