# 파일 시스템 관련 명령어

# 1. 권한 및 그룹 설정

# 1-1. 소유권과 관련 명령어

- 소유권은 임의의 파일 또는 디렉터리에 대해 사용자와 그룹들의 소유 권한을 나타낸 것이다.

`-rw-rw-r-- 1 jun jun 53 2021-11-27 18:10 test`

위의 예시에서 소유권은 사용자 jun과 그룹 jun에 있다.



## 1) 소유권과 관련된 명령어 

- chown

파일과 디렉터리의 사용자 소유권과 그룹 소유권을 변경하는 명령어

`chown [옵션] 소유자[:그룹명] 파일명`

그룹일 때는 앞에 콜론을 붙여 구별해준다.

-R 옵션을 추가하면 하위 디렉터리를 포함하여 디렉터리 내부의 모든 파일의 소유권이 변경된다.

- chgrp

그룹 소유권만 변경 가능

chown와 같은 -R 옵션 사용 가능



# 1-2. 허가권과 관련된 명령어

- chmod

파일이나 디렉터리의 접근 허가권을 변경하는 명령어



**숫자 표기**

파일 권한은 2진수 3비트를 묶어 8진수로 표기

`-rw-rw-r-- 1 jun jun 53 2021-11-27 18:10 test`

위의 예시의 경우 owner에는 read, write / group에는 read, write / other users에는 read만 부여되어 있음

8진수로 표기하면 664가 된다. 



**기호표기**

$ chmod [ugoa +/- rwx]

u = user

g = group

o = other users

a = all

`+` = add persmission

`-` = remove



- umask

새로 생성되는 파일이나 디렉터리의 기본 허가권 값을 지정한다.

기본권한 : 파일(666), 디렉터리(777)

-s 옵션으로 umask값을 나타낸다.

umask 077으로 설정하면 디렉터리의 권한은 777로 그룹과 그 외 사용자들에게 어떠한 권한도 주지 않게 된다. 



# 1-3. 특수권한

프로세스가 실행되는 동안 해당 프로세스의 root 권한을 임시로 가져오는 기능

`-rwsrw-r-- 1 jun jun 53 2021-11-27 18:10 test`

실행 파일에 setuid를 설정하면 소문자 s가 되고 정상적으로 실행할 수 있다.

`-rwsrw-r-- 1 jun jun 53 2021-11-27 18:10 test`

실행 파일이 아닌데 setuid를 설정하면 대문자 S가 되고 정상적으로 실행할 수 없다.

- setUID : 사용자가 사용할 때만 소유자 권한으로 파일을 실행
- setGID : 사용자가 사용할 때만 그룹 권한으로 파일 실행
- sticky bit: 권한기호 't', /tmp는 sticky-bit이 설정되어 있음



# 1-4. 디스크 쿼터

파일 시스템마다 사용자/그룹을 생성할 수 있는 파일 용량/개수 제한

- edquota : 편집기를 사용하여 그룹에 디스크 사용량 할당

`edquota -p bookmark ihd`

여기서 옵션 p는 디스크 할당량 설정을 다른 사용자와 동일하게 설정

- setquota : 명령행에서 직접 디스크 사용량 할당

`setquota -u ihd 20M 30M 0 0 /home`

setquota -u [계정명] [블록soft] [블록hard] [inode soft] [inode hard]

- repquota : 사용자 쿼터 정보를 출력함



# 2. 파일 시스템의 관리

# 2-1. 파일 시스템의 개요와 종류

- inode : 파일 이름, 소유주, 권한, 시간, 디스크에서의 위치 등을 담고 있음

| 이름                     | 설명                                                         |
| ------------------------ | ------------------------------------------------------------ |
| ext2                     | 파일이름 최대 255자까지 가능<br />2GB 단일 파일<br />4TB 디스크<br />저널링 기능 없음 |
| ext3                     | ext2 확장판<br />저널링 기능<br />ACL(Access Control List)   |
| nfs                      | 네트워크 파일 시스템<br />파일 공유 및 파일 서버로 사용됨    |
| cifs                     | SMB의 확장판<br />SMB(Server Message Block)는 흔히 공유 폴더라고 많이 알고 있다. |
| NTFS                     | 윈도우에서 사용하는 파일 시스템<br />대용량 파일 저장 가능   |
| udf                      | DVD 파일 시스템<br />배포판 리눅스에서 iso9660으로 지정해도 마운트할 수 있는 파일 시스템 |
| FJS, XFS, ReiserFS, ext3 | 대표적인 저널링 파일 시스템 /                                |
| JFS                      | IBM사가 개발한 저널링 파일 시스템                            |



# 2-2. 관련 명령어

- mount : 장치와 디렉터리 연결

-o : 추가 설정 (noatime : 파일이 변경되기 전까지 access time이 변경되지 않음 / ro : 읽기 전용으로 마운트)

- umnount : 연결된 장치, 디렉터리 연결 해제

floopy, usb 메모리 등의 보조기억장치 사용 후에는 반드시 이 명령을 사용한 뒤에 제거해야 데이터 손실이 없음

-a : /etc/mtab에 명시된 모든 파일 시스템의 마운트를 해제한다.

- eject : 이동식 보조기억장치 제거
- fdisk : 파티션 생성  , 삭제, 타입 결정

-p : 현재 디스크의 정보를 출력

-d : 파티션을 삭제

-n : 파티션을 새롭게 생성

-ㅣ : 현재 디스크의 파티션 테이블 정보를 나타냄

-v : fdisk 버전을 나타냄

-t : 파일 시스템 유형 결정

-s : 지정된 파티션의 크기를 블록 단위로 표시

-w : 디스크에 테이블을 기록하고 빠져나오는 명령



swap에 해당하는 속성값은 82



- mkfs : 파일 시스템 생성(포맷)

-c : 파일 시스템을 생성하기 전에 배드블록을 검사한다. 

- mke2fs : ext2, ext3, ext4 파일 시스템 생성(포맷)

-j : 파티션을 저널링 파일 시스템 ext3으로 생성

- fsck : 파일 시스템의 무결성을 점검하고 대화식으로 복구하는 명령어

-s : fsck 동작을 시리얼화, 대화형 모드에서 여러 파일 시스템 점검 시 유용

디렉터리 /lost+found는 fsck에서 사용하는 디렉터리이다. / 오류 파일들이 위치

/etc/fstab의 6번째 필드와 관련, fsck 명령어로 무결성 체크 여부를 설정

- e2fsck : ext2, ext3, ext4 파일 시스템 점검 및 복구하는 명령

-b : 파일 시스템의 블록 사이즈를 정함

-R  stripe : RAID 장치에 적합한 데이터 구조를 만든다.

- du(disk usage) : 디렉터리별 디스크 사용량 확인

-s : 파일들의 전체 크기를 합한 값(총 사용량만을 표시)

-h : 디스크 사용량을 용량 단위로 표시

- df : 시스템에 마운트된 하드 디스크의 남은 용량 확인할 때 사용(분할된 파티션별로 사용량 확인)

-T : 파일 시스템 유형과 파티션 정보 출력

-h : 용량 단위로 표시

-a : 0 블록의 파일 시스템을 포함하여 모든 파일 시스템을 출력



- 파일 etc/fstab

리눅스에서 사용하는 파일 시스템 정적 정보 저장

6개의 필드로 이루어져 있음

첫 번째 필드에는 파일 시스템 장치명, 볼륨 라벨, 또는 UUID가 올 수 있다.

user : 4번째 필드의 주요 옵션 중 로컬 시스템에서 일반 사용자가 마운트할 수 있는 권한을 부여

- 파일 etc/mtab

마운트된 파일 시스템의 목록이 필요할 때 사용

- blkid

현재 하드디스크의 파티션의 UUID와 파일 시스템 정보를 확인할 수 있음

